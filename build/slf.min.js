!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("proj4"),require("@turf/helpers"),require("@turf/area"),require("@turf/mask"),require("@julien.cousineau/util"),require("rbush"),require("@mapbox/tile-cover"),require("@mapbox/tilebelt"),require("@turf/bbox-polygon")):"function"==typeof define&&define.amd?define(["exports","proj4","@turf/helpers","@turf/area","@turf/mask","@julien.cousineau/util","rbush","@mapbox/tile-cover","@mapbox/tilebelt","@turf/bbox-polygon"],i):i(t["slf-js"]={},t.proj4,t.helpers,t.area,t.mask,t.util,t.rbush,t.cover,t.tilebelt,t.bboxPolygon)}(this,function(t,i,n,s,r,o,h,a,u,E){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i,s=s&&s.hasOwnProperty("default")?s.default:s,r=r&&r.hasOwnProperty("default")?r.default:r,h=h&&h.hasOwnProperty("default")?h.default:h,a=a&&a.hasOwnProperty("default")?a.default:a,u=u&&u.hasOwnProperty("default")?u.default:u,E=E&&E.hasOwnProperty("default")?E.default:E;var c=new function(){var t,i=!1,e=this;e._DeArray=function(t,i,e){return[t.slice(i,i+e)]},e._EnArray=function(t,i,e,n){for(var s=0;s<e;t[i+s]=n[s]?n[s]:0,s++);},e._DeChar=function(t,i){return String.fromCharCode(t[i])},e._EnChar=function(t,i,e){t[i]=e.charCodeAt(0)},e._DeInt=function(e,n){var s,r,o,h=i?t.len-1:0,a=i?-1:1,u=h+a*t.len;for(s=0,r=h,o=1;r!=u;s+=e[n+r]*o,r+=a,o*=256);return t.bSigned&&s&Math.pow(2,8*t.len-1)&&(s-=Math.pow(2,8*t.len)),s},e._EnInt=function(e,n,s){var r,o=i?t.len-1:0,h=i?-1:1,a=o+h*t.len;for(s=s<t.min?t.min:s>t.max?t.max:s,r=o;r!=a;e[n+r]=255&s,r+=h,s>>=8);},e._DeString=function(t,i,e){for(var n=new Array(e),s=0;s<e;n[s]=String.fromCharCode(t[i+s]),s++);return n.join("")},e._EnString=function(t,i,e,n){for(var s,r=0;r<e;t[i+r]=(s=n.charCodeAt(r))?s:0,r++);},e._DeNullString=function(t,i,n,s){var r=e._DeString(t,i,n,s);return r.substring(0,r.length-1)},e._De754=function(e,n){var s,r,o,h,a,u,E,c,f,l;for(E=t.mLen,f=(l=(1<<(c=8*t.len-t.mLen-1))-1)>>1,h=i?0:t.len-1,a=i?1:-1,s=e[n+h],h+=a,r=s&(1<<-(u=-7))-1,s>>=-u,u+=c;u>0;r=256*r+e[n+h],h+=a,u-=8);for(o=r&(1<<-u)-1,r>>=-u,u+=E;u>0;o=256*o+e[n+h],h+=a,u-=8);switch(r){case 0:r=1-f;break;case l:return o?NaN:1/0*(s?-1:1);default:o+=Math.pow(2,E),r-=f}return(s?-1:1)*o*Math.pow(2,r-E)},e._En754=function(e,n,s){var r,o,h,a,u,E,c,f,l,N;for(c=t.mLen,l=(N=(1<<(f=8*t.len-t.mLen-1))-1)>>1,r=s<0?1:0,s=Math.abs(s),isNaN(s)||s==1/0?(h=isNaN(s)?1:0,o=N):(o=Math.floor(Math.log(s)/Math.LN2),s*(E=Math.pow(2,-o))<1&&(o--,E*=2),(s+=o+l>=1?t.rt/E:t.rt*Math.pow(2,1-l))*E>=2&&(o++,E/=2),o+l>=N?(h=0,o=N):o+l>=1?(h=(s*E-1)*Math.pow(2,c),o+=l):(h=s*Math.pow(2,l-1)*Math.pow(2,c),o=0)),a=i?t.len-1:0,u=i?-1:1;c>=8;e[n+a]=255&h,a+=u,h/=256,c-=8);for(o=o<<c|h,f+=c;f>0;e[n+a]=255&o,a+=u,o/=256,f-=8);e[n+a-u]|=128*r},e._sPattern="(\\d+)?([AxcbBhHsSfdiIlL])(\\(([a-zA-Z0-9]+)\\))?",e._lenLut={A:1,x:1,c:1,b:1,B:1,h:2,H:2,s:1,S:1,f:4,d:8,i:4,I:4,l:4,L:4},e._elLut={A:{en:e._EnArray,de:e._DeArray},s:{en:e._EnString,de:e._DeString},S:{en:e._EnString,de:e._DeNullString},c:{en:e._EnChar,de:e._DeChar},b:{en:e._EnInt,de:e._DeInt,len:1,bSigned:!0,min:-Math.pow(2,7),max:Math.pow(2,7)-1},B:{en:e._EnInt,de:e._DeInt,len:1,bSigned:!1,min:0,max:Math.pow(2,8)-1},h:{en:e._EnInt,de:e._DeInt,len:2,bSigned:!0,min:-Math.pow(2,15),max:Math.pow(2,15)-1},H:{en:e._EnInt,de:e._DeInt,len:2,bSigned:!1,min:0,max:Math.pow(2,16)-1},i:{en:e._EnInt,de:e._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},I:{en:e._EnInt,de:e._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},l:{en:e._EnInt,de:e._DeInt,len:4,bSigned:!0,min:-Math.pow(2,31),max:Math.pow(2,31)-1},L:{en:e._EnInt,de:e._DeInt,len:4,bSigned:!1,min:0,max:Math.pow(2,32)-1},f:{en:e._En754,de:e._De754,len:4,mLen:23,rt:Math.pow(2,-24)-Math.pow(2,-77)},d:{en:e._En754,de:e._De754,len:8,mLen:52,rt:0}},e._UnpackSeries=function(i,e,n,s){for(var r=t.de,o=[],h=0;h<i;o.push(r(n,s+h*e)),h++);return o},e._PackSeries=function(i,e,n,s,r,o){for(var h=t.en,a=0;a<i;h(n,s+a*e,r[o+a]),a++);},e._zip=function(t,i){for(var e={},n=0;n<t.length;n++)e[t[n]]=i[n];return e},e.unpack=function(e,n,s){i="<"!=e.charAt(0),s=s||0;for(var r,o,h,a=new RegExp(this._sPattern,"g"),u=[],E=[];r=a.exec(e);){if(o=null==r[1]||""==r[1]?1:parseInt(r[1]),"S"===r[2]){for(o=0;0!==n[s+o];)o++;o++}if(s+o*(h=this._lenLut[r[2]])>n.length)return;switch(r[2]){case"A":case"s":case"S":E.push(this._elLut[r[2]].de(n,s,o));break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":t=this._elLut[r[2]],E.push(this._UnpackSeries(o,h,n,s))}u.push(r[4]),s+=o*h}return E=Array.prototype.concat.apply([],E),-1!==u.indexOf(void 0)?E:this._zip(u,E)},e.packTo=function(e,n,s,r){i="<"!=e.charAt(0);for(var o,h,a,u,E=new RegExp(this._sPattern,"g"),c=0;o=E.exec(e);){if(h=null==o[1]||""==o[1]?1:parseInt(o[1]),"S"===o[2]&&(h=r[c].length+1),s+h*(a=this._lenLut[o[2]])>n.length)return!1;switch(o[2]){case"A":case"s":case"S":if(c+1>r.length)return!1;this._elLut[o[2]].en(n,s,h,r[c]),c+=1;break;case"c":case"b":case"B":case"h":case"H":case"i":case"I":case"l":case"L":case"f":case"d":if(t=this._elLut[o[2]],c+h>r.length)return!1;this._PackSeries(h,a,n,s,r,c),c+=h;break;case"x":for(u=0;u<h;u++)n[s+u]=0}s+=h*a}return n},e.pack=function(t,i){return this.packTo(t,new Buffer(this.calcLength(t,i)),0,i)},e.calcLength=function(t,i){for(var e,n=new RegExp(this._sPattern,"g"),s=0,r=0;e=n.exec(t);){var o=(null==e[1]||""==e[1]?1:parseInt(e[1]))*this._lenLut[e[2]];"S"===e[2]&&(o=i[r].length+1),s+=o,"x"!==e[2]&&r++}return s}};i.defs("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i.defs("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i.defs("EPSG:3156","+proj=utm +zone=9 +ellps=GRS80 +units=m +no_defs "),i.defs("EPSG:3159","+proj=utm +zone=15 +ellps=GRS80 +units=m +no_defs"),i.defs("EPSG:3857","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs");var f=function(t,i){i||(i={}),this.debug=i.debug||!1,this.fromProj=i.fromProj||"EPSG:4326",this.toProj=i.toProj||"EPSG:4326",this.keepframes=void 0===i.keepframes||i.keepframes,t?this.initialised(t):this.initialisedBlank()},l={TRIXY:{configurable:!0},varnames:{configurable:!0},XY:{configurable:!0},IKLEW:{configurable:!0},EDGES:{configurable:!0},BEDGES:{configurable:!0},IEDGES:{configurable:!0},CX:{configurable:!0},CY:{configurable:!0},TRIAREA:{configurable:!0},TRIBBOX:{configurable:!0},BBOX:{configurable:!0},EXTENT:{configurable:!0},POLYGON:{configurable:!0},EXTERIOR:{configurable:!0},INTERIORS:{configurable:!0},POLYGONS:{configurable:!0}};f.prototype.initialisedBlank=function(){this.file={endian:">",float:["f",4]},this.TITLE="",this.NBV1=0,this.NBV2=0,this.NVAR=this.NBV1+this.NBV2,this.VARINDEX=o.range(this.NVAR),this.IPARAM=[],this.NELEM3=0,this.NPOIN3=0,this.NDP3=0,this.NPLAN=1,this.NELEM2=0,this.NPOIN2=0,this.NDP2=0,this.NBV1=0,this.VARNAMES=[],this.VARUNITS=[],this.NBV2=0,this.CLDNAMES=[],this.CLDUNITS=[],this.IKLE3=[],this.IKLE2=[],this.IPOB2=[],this.IPOB3=[],this.MESHX=[],this.MESHY=[],this.tags={cores:[],times:[]},this.NFRAME=0},f.prototype.initialised=function(t){var i=this.debug;i&&console.time("Initialised selafin object"),i&&console.time("Buffer to Uint8Array"),this.uint8array=new Uint8Array(t),i&&console.timeEnd("Buffer to Uint8Array"),this.file={},this.file.endian=this.getEndianFromChar(80);var e=this.getHeaderMetaDataSLF();i&&console.time("Get connectivity matrix");var n=this.getHeaderIntegersSLF(e);i&&console.timeEnd("Get connectivity matrix"),i&&console.time("Change connectivity matrix: id to index"),this.IKLE3.add(-1),i&&console.timeEnd("Change connectivity matrix: id to index"),i&&console.time("Reorder connectivity matrix"),this.IKLE3F=this.IKLE3,this.IKLE3=this.reshapeIKLE(),i&&console.timeEnd("Reorder connectivity matrix"),this.file.float=this.getFloatTypeFromFloat(n),i&&console.time("Get mesh XY");var s=this.getHeaderFloatsSLF(n);i&&console.timeEnd("Get mesh XY"),i&&console.time("Get frame tags"),this.tags=this.getTimeHistorySLF(s),i&&console.timeEnd("Get frame tags"),this.keepframes&&this.getFrames(),i&&console.time("Transform mesh XY"),this.transform(),i&&console.timeEnd("Transform mesh XY"),this.initializeProperties(),i&&(console.timeEnd("Initialised selafin object"),console.log("NELEM:%d,NPOIN:%d,NFRAME:%d",this.NELEM3,this.NPOIN3,this.NFRAME))},f.prototype.initializeProperties=function(){this._TRIXY=null,this._TRIAREA=null,this._CX=null,this._CY=null,this._EDGES=null,this._BEDGES=null,this._IEDGES=null},f.prototype.getEndianFromChar=function(t){var i,e,n,s,r=this.uint8array,o=">";if(n=(i=c.unpack(o+"i"+t+"si",r,0))[0],i[1],(s=i[2])!=t&&(o="<",n=(e=c.unpack(o+"i"+t+"si",r,0))[0],e[1],s=e[2]),n!=s)throw Error("... Cannot read "+t+" characters from your binary file +> Maybe it is the wrong file format ?");return o},f.prototype.getHeaderMetaDataSLF=function(){var t,i,e,n,s=this.uint8array,r=this.file.endian,h=0;(t=c.unpack(r+"i80si",s,h))[0],this.TITLE=t[1],t[2],h+=88,(i=c.unpack(r+"iiii",s,h))[0],this.NBV1=i[1],this.NBV2=i[2],i[3],h+=16,this.NVAR=this.NBV1+this.NBV2,this.VARINDEX=o.range(this.NVAR,"Uint8Array"),this.VARNAMES=[],this.VARUNITS=[],this.CLDNAMES=[],this.CLDUNITS=[];for(var a=0;a<this.NBV1;a++){var u,E;(e=c.unpack(r+"i16s16si",s,h))[0],u=e[1],E=e[2],e[3],h+=40,this.VARNAMES.push(u),this.VARUNITS.push(E)}for(var f=0;f<this.NBV2;f++){var l,N;(n=c.unpack(r+"i16s16si",s,h))[0],l=n[1],N=n[2],n[3],h+=40,this.CLDNAMES.push(l),this.CLDUNITS.push(N)}var p=c.unpack(r+"12i",s,h);return h+=48,this.IPARAM=p.slice(1,11),this.PROJ=this.IPARAM[1],this.DATETIME=new Uint16Array([1972,7,13,17,15,13]),1==this.IPARAM[9]&&(p=c.unpack(r+"8i",h),h+=32,this.DATETIME=p.slice(1,9)),h},f.prototype.getHeaderIntegersSLF=function(t){var i,e=this.uint8array,n=this.file.endian;if((i=c.unpack(n+"6i",e,t))[0],this.NELEM3=i[1],this.NPOIN3=i[2],this.NDP3=i[3],this.NPLAN=i[4],i[5],t+=24,this.NELEM2=this.NELEM3,this.NPOIN2=this.NPOIN3,this.NDP2=this.NDP3,this.NPLAN=Math.max(1,this.NPLAN),this.IPARAM[6]>1&&(this.NPLAN=this.IPARAM[6],this.NELEM2=this.NELEM3/(this.NPLAN-1),this.NPOIN2=this.NPOIN3/this.NPLAN,this.NDP2=this.NDP3/2),t+=4,this.IKLE3=new Uint32Array(c.unpack(n+this.NELEM3*this.NDP3+"i",e,t)),t+=4*this.NELEM3*this.NDP3,t+=4,this.NPLAN>1)throw Error("Check Javascript for 3D");return t+=4,this.IPOB3=new Uint32Array(c.unpack(n+this.NPOIN3+"i",e,t)),t+=4*this.NPOIN3,t+=4},f.prototype.getFloatTypeFromFloat=function(t){var i=this.uint8array,e=this.file.endian,n=this.NPOIN3,s=4,r="f",o=c.unpack(e+"i",i,t);t+=4,o[0]!=s*n&&(s=8,r="d"),t+=s*n;var h=c.unpack(e+"i",i,t);if(o[0]!=h[0])throw Error("... Cannot read "+n+" floats from your binary file +> Maybe it is the wrong file format ?");return[r,s]},f.prototype.getHeaderFloatsSLF=function(t){var i=this.uint8array,e=this.file.endian,n=this.file.float,s=n[0],r=n[1];return t+=4,this.MESHX=new Float32Array(c.unpack(e+this.NPOIN3+s,i,t)),t+=r*this.NPOIN3,t+=4,t+=4,this.MESHY=new Float32Array(c.unpack(e+this.NPOIN3+s,i,t)),t+=r*this.NPOIN3,t+=4},f.prototype.getTimeHistorySLF=function(t){var i=this.uint8array,e=this.file.endian,n=this.file.float,s=n[0],r=n[1];for(varATs=[],ATt=[];;)try{ATt.push(t),t+=4,ATs.push(c.unpack(e+s,i,t)[0]),t+=r,t+=4,t+=this.NVAR*(4+r*this.NPOIN3+4)}catch(t){ATt.pop(ATt.length-1);break}return this.NFRAME=ATs.length,{cores:ATt,times:new Float32Array(ATs)}},f.prototype.writeHeaderSLF=function(){var t=this.file.endian,i=this.file.float,e=i[0],n=i[1],s=new Buffer(0);s=Buffer.concat([s,c.pack(t+"i80si",[80,this.TITLE,80])]),s=Buffer.concat([s,c.pack(t+"iiii",[8,this.NBV1,this.NBV2,8])]);for(var r=0;r<this.NBV1;r++)s=Buffer.concat([s,c.pack(t+"i16s16si",[32,this.VARNAMES[r],this.VARUNITS[r],32])]);for(var o=0;o<this.NBV2;o++)s=Buffer.concat([s,c.pack(t+"i16s16si",[32,this.CLDNAMES[o],this.CLDUNITS[o],32])]);s=Buffer.concat([s,c.pack(t+"i",[40])]);for(var h=0;h<this.IPARAM.length;h++)s=Buffer.concat([s,c.pack(t+"i",[this.IPARAM[h]])]);if(s=Buffer.concat([s,c.pack(t+"i",[40])]),1==this.IPARAM[9]){s=Buffer.concat([s,c.pack(t+"i",[24])]);for(var a=0;a<6;a++)s=Buffer.concat([s,c.pack(t+"i",[this.DATETIME[a]])]);s=Buffer.concat([s,c.pack(t+"i",[24])])}s=Buffer.concat([s,c.pack(t+"6i",[16,this.NELEM3,this.NPOIN3,this.NDP3,1,16])]),s=Buffer.concat([s,c.pack(t+"i",[4*this.NELEM3*this.NDP3])]),s=Buffer.concat([s,c.pack(t+"{0}i".format(this.NELEM3*this.NDP3),this.IKLE3F.add(1))]),s=Buffer.concat([s,c.pack(t+"i",[4*this.NELEM3*this.NDP3])]),s=Buffer.concat([s,c.pack(t+"i",[4*this.NPOIN3])]),s=Buffer.concat([s,c.pack(t+(this.NPOIN3+"i"),this.IPOB3)]),s=Buffer.concat([s,c.pack(t+"i",[4*this.NPOIN3])]),s=Buffer.concat([s,c.pack(t+"i",[n*this.NPOIN3])]);for(var u=0;u<this.NPLAN;u++)s=Buffer.concat([s,c.pack(t+(this.NPOIN2+e),this.MESHX)]);s=Buffer.concat([s,c.pack(t+"i",[n*this.NPOIN3])]),s=Buffer.concat([s,c.pack(t+"i",[n*this.NPOIN3])]);for(var E=0;E<this.NPLAN;E++)s=Buffer.concat([s,c.pack(t+(this.NPOIN2+e),this.MESHY)]);return s=Buffer.concat([s,c.pack(t+"i",[n*this.NPOIN3])])},f.prototype.writeCoreTimeSLF=function(t,i){var e=this.file.endian,n=this.file.float,s=n[0],r=n[1],o=0!=this.tags.times.length&&this.tags.times[i]?this.tags.times[i]:i;return t=Buffer.concat([t,c.pack(e+"i"+s+"i",[r,o,r])])},f.prototype.writeCoreVarSLF=function(t,i){for(var e=this.file.endian,n=this.file.float,s=n[0],r=n[1],o=0;o<this.NVAR;o++){var h=this.getFrame(i,o);t=Buffer.concat([t,c.pack(e+"i",[r*this.NPOIN3])]),t=Buffer.concat([t,c.pack(e+(this.NPOIN3+s),h)]),t=Buffer.concat([t,c.pack(e+"i",[r*this.NPOIN3])])}return t},f.prototype.getBuffer=function(){for(var t=this.writeHeaderSLF(),i=0;i<this.NFRAME;i++)t=this.writeCoreTimeSLF(t,i),t=this.writeCoreVarSLF(t,i);return t},f.prototype.getFrames=function(){for(var t=this.uint8array,i=this.file.endian,e=this.file.float,n=e[0],s=e[1],r=this.FRAMES=new Float32Array(this.NFRAME*this.NVAR*this.NPOIN3),o=0;o<this.NFRAME;o++){var h=this.tags.cores[o];h+=4+s+4;for(var a=0;a<this.NVAR;a++)h+=4,r.set(c.unpack(i+this.NPOIN3+n,t,h),o*this.NVAR*this.NPOIN3+a*this.NPOIN3),h+=s*this.NPOIN3,h+=4}},f.prototype.getFrame=function(t,i){if(!this.FRAMES)return console.warn("this.FRAMES is null. Add keepframes=true in options"),null;if(i=void 0!==i?i:0,!((t=void 0!==t?t:0)>=0&&t<this.NFRAME))throw Error("Check frame({0}) id={1} ".format(this.NFRAME,t));if(!(i>=0&&i<this.NVAR))throw Error("Check variable id");return this.FRAMES.subarray(t*this.NVAR*this.NPOIN3+i*this.NPOIN3,t*this.NVAR*this.NPOIN3+i*this.NPOIN3+this.NPOIN3)},f.prototype.getMinMax=function(){for(var t=new Float32Array(2*this.NVAR),i=0;i<this.NVAR;i++){for(var e=Number.MIN_VALUE,n=Number.MAX_VALUE,s=0;s<this.NFRAME;s++){var r=this.getFrame(s);n=Math.min(n,r.min()),e=Math.max(e,r.max())}t[2*i]=n,t[2*i+1]=e}return t},f.prototype.getVarMinMax=function(t){return this.minmax.subarray(2*t,2*t+1)},f.prototype.getElements=function(t){if(!t)return this.IKLE3F;if(!Number.isInteger(t)&&!Array.isArray(t))return this.IKLE3F;t=Number.isInteger(t)?[t]:t,this.debug&&console.time("Get elements");for(var i=new Uint32Array(t.length*this.NDP3),e=0,n=0,s=t.length;e<s;e++,n+=3)i[n+0]=this.IKLE3F[t[e]],i[n+1]=this.IKLE3F[t[e]+1],i[n+2]=this.IKLE3F[t[e]+2];return this.debug&&console.timeEnd("Get elements"),i},f.prototype.getElementsW=function(t){if(!t)return this.IKLE3F;if(!Number.isInteger(t)&&!Array.isArray(t))return this.IKLE3F;t=Number.isInteger(t)?[t]:t,this.debug&&console.time("Get elementsW");for(var i=new Uint32Array(t.length*this.NDP3*2),e=0,n=0,s=t.length;e<s;e++,n+=6,3)i[n+0]=this.IKLE3F[t[e]],i[n+1]=this.IKLE3F[t[e]+1],i[n+2]=this.IKLE3F[t[e]+1],i[n+3]=this.IKLE3F[t[e]+2],i[n+4]=this.IKLE3F[t[e]+2],i[n+5]=this.IKLE3F[t[e]];return this.debug&&console.timeEnd("Get elementsW"),i},f.prototype.reshapeIKLE=function(){for(var t=new Uint32Array(this.NELEM3*this.NDP3),i=0,e=0;i<this.NELEM3;i++,e+=3)t[i]=this.IKLE3[e],t[i+this.NELEM3]=this.IKLE3[e+1],t[i+2*this.NELEM3]=this.IKLE3[e+2];return t},f.prototype.changeProj=function(t,i){this.fromProj=t,this.toProj=i,t!==i&&(this.initializeProperties(),this.transform())},f.prototype.transform=function(){var t=this.fromProj,e=this.toProj;if(t!==e){for(var n,s=i(t,e),r=0;r<this.NPOIN3;r++)n=s.forward([this.MESHX[r],this.MESHY[r]]),this.MESHX[r]=n[0],this.MESHY[r]=n[1];this.fromProj=e}},l.TRIXY.get=function(){return this._TRIXY||this.getTriXY(),this._TRIXY},l.varnames.get=function(){return this.VARNAMES.map(function(t){return t.replace(/\s/g,"").toLowerCase()})},f.prototype.getVarIndex=function(t){return this.varnames.findIndex(function(i){return i==t})},l.XY.get=function(){return this._XY||this.getXY(),this._XY},l.IKLEW.get=function(){return this._IKLEW||this.getIKLEW(),this._IKLEW},l.EDGES.get=function(){return this._EDGES||this.getEDGES(),this._EDGES},l.BEDGES.get=function(){return this._BEDGES||this.getBEDGES(),this._BEDGES},l.IEDGES.get=function(){return this._IEDGES||this.getIEDGES(),this._IEDGES},l.CX.get=function(){return this._CX||this.getTriAttributes(),this._CX},l.CY.get=function(){return this._CY||this.getTriAttributes(),this._CY},l.TRIAREA.get=function(){return this._TRIAREA||this.getTriAttributes(),this._TRIAREA},l.TRIBBOX.get=function(){return this._TRIBBOX||this.getTriAttributes(),this._TRIBBOX},l.BBOX.get=function(){return this.EXTENT},l.EXTENT.get=function(){return this._EXTENT||this.getExtent(),this._EXTENT},l.POLYGON.get=function(){return this._POLYGON||this.getPolygon(),this._POLYGON},l.EXTERIOR.get=function(){return this._EXTERIOR||this.getExterior(),this._EXTERIOR},l.INTERIORS.get=function(){return this._INTERIORS||this.getExterior(),this._INTERIORS},l.POLYGONS.get=function(){return this._POLYGONS||this.getPolygons(),this._POLYGONS},f.prototype.getExtent=function(){this.debug&&console.time("Get extent"),this._EXTENT=new Float32Array([this.MESHX.min(),this.MESHY.min(),this.MESHX.max(),this.MESHY.max()]),this.debug&&console.timeEnd("Get extent")},f.prototype.getExterior=function(){this.debug&&console.time("Get exterior/interiors");var t=this.POLYGONS,i=t.map(function(t){return s(t)}),e=this._INTERIORS=i.sortIndices(!0).map(function(i){return t[i]});this._EXTERIOR=e.shift(),this.debug&&console.timeEnd("Get exterior/interiors")},f.prototype.getCoordinate=function(t){return[this.MESHX[t],this.MESHY[t]]},f.prototype.getPolygon=function(){this.debug&&console.time("Get polygon"),0==this.INTERIORS.length?this._POLYGON=this.EXTERIOR:this._POLYGON=r(n.featureCollection(this.INTERIORS),this.EXTERIOR),this.debug&&console.timeEnd("Get polygon")},f.prototype.getPolygons=function(){this.debug&&console.time("Get polygons");for(var t,i,e=this.BEDGES,s=this._POLYGONS=[],r=-1,o=[];e.length>0;)-1==(t=e.findIndex(function(t){return t.start==r||t.end==r}))?(o.length>0&&(s.push(n.polygon([o])),o=[]),i=e[0].start,r=e[0].end,o.push(this.getCoordinate(i)),o.push(this.getCoordinate(r)),e.splice(0,1)):(r=e[t].start==r?e[t].end:e[t].start,o.push(this.getCoordinate(r)),e.splice(t,1),0==e.length&&o.length>0&&s.push(n.polygon([o])));this.debug&&console.timeEnd("Get polygons")},f.prototype.getIKLEW=function(){this.debug&&console.time("Get connectivity for wireframe");for(var t=this._IKLEW=new Uint32Array(this.NELEM3*this.NDP3*2),i=0,e=0,n=0;i<this.NELEM3;i++,e+=6,n+=3)t[e]=this.IKLE3F[n],t[e+1]=this.IKLE3F[n+1],t[e+2]=this.IKLE3F[n+1],t[e+3]=this.IKLE3F[n+2],t[e+4]=this.IKLE3F[n+2],t[e+5]=this.IKLE3F[n];this.debug&&console.timeEnd("Get connectivity for wireframe")},f.prototype.getTriXY=function(){this.debug&&console.time("Get element xy");for(var t,i,e,n=this._TRIXY=new Float32Array(this.NELEM3*this.NDP3*3),s=0,r=0,o=this.NELEM3;s<o;s++,r+=9)t=this.IKLE3[s],i=this.IKLE3[s+this.NELEM3],e=this.IKLE3[s+2*this.NELEM3],n[r]=this.MESHX[t],n[r+1]=this.MESHY[t],n[r+3]=this.MESHX[i],n[r+4]=this.MESHY[i],n[r+6]=this.MESHX[e],n[r+7]=this.MESHY[e];this.debug&&console.timeEnd("Get element xy")},f.prototype.getXY=function(){this.debug&&console.time("Get points xy");for(var t=this._XY=new Float32Array(3*this.NPOIN3),i=0,e=0,n=this.NPOIN3;i<n;i++,e+=3)t[e]=this.MESHX[i],t[e+1]=this.MESHY[i];this.debug&&console.timeEnd("Get points xy")},f.prototype.getBEDGES=function(){this.debug&&console.time("Get bedges");var t=this.EDGES;this._BEDGES=Object.keys(t).filter(function(i){return!t[i].boundary}).map(function(i){return t[i]}),this.debug&&console.timeEnd("Get bedges")},f.prototype.getIEDGES=function(){this.debug&&console.time("Get iedges");var t=this.EDGES;this._IEDGES=Object.keys(t).filter(function(i){return t[i].boundary}).map(function(i){return t[i]}),this.debug&&console.timeEnd("Get iedges")},f.prototype.getEDGES=function(){this.debug&&console.time("Get edges");var t,i,n,s,r,o,h=this._EDGES={};for(vare=0;e<this.NELEM3;e++)t=this.IKLE3[e],i=this.IKLE3[e+this.NELEM3],n=this.IKLE3[e+2*this.NELEM3],s="{0}-{1}".format(Math.min(t,i),Math.max(t,i)),r="{0}-{1}".format(Math.min(i,n),Math.max(i,n)),o="{0}-{1}".format(Math.min(n,t),Math.max(n,t)),void 0!==h[s]?h[s].boundary=!0:h[s]={boundary:!1,start:Math.min(t,i),end:Math.max(t,i)},void 0!==h[r]?h[r].boundary=!0:h[r]={boundary:!1,start:Math.min(i,n),end:Math.max(i,n)},void 0!==h[o]?h[o].boundary=!0:h[o]={boundary:!1,start:Math.min(n,t),end:Math.max(n,t)};this.debug&&console.timeEnd("Get edges")},f.prototype.getTriAttributes=function(){this.debug&&console.time("Get element attributes");for(var t,i,e,n=this._CX=new Float32Array(this.NELEM3),s=this._CY=new Float32Array(this.NELEM3),r=this._TRIAREA=new Float32Array(this.NELEM3),o=this._TRIBBOX=new Array(this.NELEM3),h=0,a=this.NELEM3;h<a;h++)t=this.IKLE3[h],i=this.IKLE3[h+this.NELEM3],e=this.IKLE3[h+2*this.NELEM3],n[h]=(this.MESHX[t]+this.MESHX[i]+this.MESHX[e])/3,s[h]=(this.MESHY[t]+this.MESHY[i]+this.MESHY[e])/3,o[h]={minX:Math.min(this.MESHX[t],Math.min(this.MESHX[i],this.MESHX[e])),minY:Math.min(this.MESHY[t],Math.min(this.MESHY[i],this.MESHY[e])),maxX:Math.max(this.MESHX[t],Math.max(this.MESHX[i],this.MESHX[e])),maxY:Math.max(this.MESHY[t],Math.max(this.MESHY[i],this.MESHY[e])),index:h},r[h]=Math.abs(.5*((this.MESHX[i]-this.MESHX[t])*(this.MESHY[e]-this.MESHY[t])-(this.MESHX[e]-this.MESHX[t])*(this.MESHY[i]-this.MESHY[t])));this.debug&&console.timeEnd("Get element attributes")},f.prototype.addTITLE=function(t){this.TITLE="{0}".format(t.rpad(" ",80))},f.prototype.addVAR=function(t){t||(t={});var i=t.name||"NewVariable",e=t.unit||"NewUnit";this.NBV1+=1,this.NVAR=this.NBV1+this.NBV2,this.VARINDEX=o.range(this.NVAR),this.VARNAMES.push("{0}".format(i.rpad(" ",16))),this.VARUNITS.push("{0}".format(e.rpad(" ",16)))},f.prototype.addPOINTS=function(t,i){if(!t)throw new Error("Requires points");this.IPOB3=new Uint32Array(t.length).range(),this.IPOB2=this.IPOB3,this.IPARAM=new Uint8Array(10),this.IPARAM[0]=1,this.NPOIN2=t.length,this.NPOIN3=this.NPOIN2,i?this._addXY(t,i):this._addPoints(t)},f.prototype._addXY=function(t,i){this.MESHX=t,this.MESHY=i},f.prototype._addPoints=function(t){this.MESHX=new Float32Array(this.NPOIN3),this.MESHY=new Float32Array(this.NPOIN3);for(var i=0;i<this.NPOIN3;i++)this.MESHX[i]=t[i].x,this.MESHY[i]=t[i].y},f.prototype.addIKLE=function(t){this.NDP2=3,this.NDP3=3,this.NELEM3=t.length/this.NDP3,this.NELEM2=this.NELEM3,this.IKLE2=t,this.IKLE3=t,this.IKLE3F=this.IKLE3,this.IKLE3=this.reshapeIKLE()},f.prototype.addFrame=function(t){if(t.length!=this.NVAR*this.NPOIN3)throw new Error("Wrong array size");if(this.NFRAME+=1,!this.FRAMES)return this.FRAMES=t;var i=this.FRAMES;this.FRAMES=new Float32Array(this.NFRAME*this.NVAR*this.NPOIN3),this.FRAMES.set(i,0),this.FRAMES.set(t,(this.NFRAME-1)*this.NVAR*this.NPOIN3)},f.prototype.addMesh=function(t,i,e,n){this.empty=!1,this.addTITLE(t),this.addVAR(i),this.addPOINTS(e),this.addIKLE(n)},f.prototype.printAttributes=function(){var t={NFRAME:this.NFRAME,NVAR:this.NVAR,NPOIN3:this.NPOIN3,NELEM3:this.NELEM3,EXTENT:this.EXTENT};console.log(t)},Object.defineProperties(f.prototype,l);var N=function(t){function i(i,e){t.call(this,i,e)}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var e={position:{configurable:!0},indices:{configurable:!0},indicesW:{configurable:!0}};return e.position.get=function(){return this.XY},e.indices.get=function(){return this.IKLE3F},e.indicesW.get=function(){return this.IKLE3W},Object.defineProperties(i.prototype,e),i}(f),p=function(t){function i(i,e){e.toProj="EPSG:3857",t.call(this,i,e),this.tileLimits=e.tileLimits||{min_zoom:1,max_zoom:12},this.eLimit=e.eLimit||5e4,this.quadkey=""}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var e={position:{configurable:!0},indices:{configurable:!0},indicesW:{configurable:!0},TILES:{configurable:!0},KDTREE:{configurable:!0}};return i.prototype.setQuadkey=function(t){this.quadkey=t,this._indices=null,this._indicesW=null},e.position.get=function(){return this.XY},e.indices.get=function(){return this._indices||this.getIndices(),this._indices},e.indicesW.get=function(){return this._indices||this.getIndices(),this._indicesW},e.TILES.get=function(){return this._TILES||this.getTiles(),this._TILES},e.KDTREE.get=function(){return this._KDTREE||this.getKDTree(),this._KDTREE},i.prototype.getIndices=function(){var t=this.TILES[this.quadkey];if(!t)return null;"string"==typeof t&&(t=this.TILES[t]),this._indices=this.getElements(t),this._indicesW=this.getElementsW(t)},i.prototype.getKDTree=function(){this.debug&&console.time("Get kdtree"),(this._KDTREE=h()).load(this.TRIBBOX),this.debug&&console.timeEnd("Get kdtree")},i.prototype.getTiles=function(){var t=this;this.debug&&console.time("Get tiles");var i=this.eLimit,e=this.tileLimits,n=e.min_zoom,s=e.max_zoom,r=o.range(s-n).add(n),h=E(this.EXTENT).geometry,c=this._TILES={};r.forEach(function(e){a.indexes(h,{min_zoom:e,max_zoom:e}).forEach(function(e){if(e){var n=u.quadkeyToTile(e),s=u.tileToQuadkey(u.getParent(n));if(c[s]&&!Array.isArray(c[s]))c[e]=c[s];else if(c[s]&&Array.isArray(c[s])&&c[s].length<i)c[e]=s;else{var r=u.tileToBBOX(n),o=t.KDTREE.search({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}).filter(function(i){return t.intersect(i.index,r)}).map(function(t){return t.index});if(0==o.length)return c[e]=s;if(o<i)return c[e]=o;var h=o.map(function(i){return[i,t.TRIAREA[i]]}).sort(function(t,i){return i[1]-t[1]}).map(function(t){return t[0]});c[e]=h.slice(0,i)}}})}),this.debug&&console.timeEnd("Get tiles")},i.prototype.getTile=function(t){return this.TILES[t]},i.prototype.intersect=function(t,i){var e=this.IKLE3[t],n=this.IKLE3[t+this.NELEM3],s=this.IKLE3[t+2*this.NELEM3],r=[this.MESHX[e],this.MESHY[e]],o=[this.MESHX[n],this.MESHY[n]],h=[this.MESHX[s],this.MESHY[s]];if(g(r,i))return!0;if(g(o,i))return!0;if(g(h,i))return!0;var a=[i[0],i[1]],u=[i[0],i[3]],E=[i[2],i[3]],c=[i[2],i[1]],f=[r,o],l=[o,h],N=[h,r],p=[a,u],I=[u,E],m=[E,c],M=[c,a];return!!d(f,p)||(!!d(f,I)||(!!d(f,m)||(!!d(f,M)||(!!d(l,p)||(!!d(l,I)||(!!d(l,m)||(!!d(l,M)||(!!d(N,p)||(!!d(N,I)||(!!d(N,m)||(!!d(N,M)||void 0)))))))))))},Object.defineProperties(i.prototype,e),i}(f);function d(t,i){var e=t[0][0],n=t[0][1],s=t[1][0],r=t[1][1],o=i[0][0],h=i[0][1],a=i[1][0],u=i[1][1],E=(u-h)*(s-e)-(a-o)*(r-n);if(0===E)return null;var c=((a-o)*(n-h)-(u-h)*(e-o))/E,f=((s-e)*(n-h)-(r-n)*(e-o))/E;return c>=0&&c<=1&&f>=0&&f<=1||null}function g(t,i){return i[0]<=t[0]&&i[1]<=t[1]&&i[2]>=t[0]&&i[3]>=t[1]}t.Selafin=f,t.SelafinGL=N,t.SelafinMP=p,Object.defineProperty(t,"__esModule",{value:!0})});
